#!/bin/sh
set -e

# Check which directories have changes
FRONTEND_CHANGED=$(git diff --cached --name-only | grep "^frontend/" || true)
BACKEND_CHANGED=$(git diff --cached --name-only | grep "^backend/" || true)

# Run lint-staged in subdirectories
if [ -n "$FRONTEND_CHANGED" ]; then
  echo "Running lint-staged in frontend..."
  (cd frontend && npx lint-staged) || exit $?
fi

if [ -n "$BACKEND_CHANGED" ]; then
  echo "Running lint-staged in backend..."
  (cd backend && npx lint-staged) || exit $?
fi

# Run tests if files changed
if [ -n "$FRONTEND_CHANGED" ]; then
  echo "Running frontend tests..."
  (cd frontend && npm run test) || exit $?
fi
